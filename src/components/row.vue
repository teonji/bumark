<script setup>
import customSelect from '../components/custom-select.vue'
import {ref, defineProps, defineEmits, /*computed*/} from 'vue'
const props = defineProps({
  id: {
    type: String,
    required: true
  },
  title: {
    type: String,
    required: true
  },
  date: {
    type: String,
    required: true
  },
  tags: {
    type: Array,
    required: true
  },
  url: {
    type: String,
    required: true
  },
  settings: {
    type: Object,
    required: true
  },
  categories: {
    type: Array,
    default: () => []
  },
  provider: {
    type: String,
    default: null
  },
  description: {
    type: String,
    default: null
  },
  image: {
    type: String,
    default: null
  },
  icon: {
    type: String,
    default: null
  },
  category: {
    type: String,
    default: null
  },
  notes: {
    type: String,
    default: null
  },
  canEdit: {
    type: Boolean,
    default: false
  },
})
// const dateFormatted = computed(() => dayjs(props.date).format(props.settings.dateFormat))
const emit = defineEmits(['open', 'tag', 'remove', 'change'])
const copied = ref(false)
const open = () => props.canEdit ? emit('open', props.url) : null
const remove = () => emit('remove', props.id)
const toggleTag = tag => emit('tag', tag)
const change = (id, name, value) => emit('change', { id, name, value })
const changeCategory = category => change(props.id, 'category', category)
const copy = () => {
  navigator.clipboard.writeText(props.url)
  copied.value = true
  setTimeout(() => {
    copied.value = false
  }, 2000)
}
</script>

<template>
  <div class="max-w-3xl w-full mx-auto z-10">
    <div class="flex flex-col">
      <div class="bg-white border border-white shadow-lg rounded-3xl p-2">
        <div class="relative">
          <span v-if="canEdit" class="absolute top-0 right-0">
            <button @click="remove" type="button" class="bg-white opacity-70 rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100">
              <i class="fas fa-times-circle"></i>
            </button>
          </span>
          <span class="absolute top-0 left-0">
            <button @click="copy" type="button" class="rounded-md p-2 inline-flex items-center justify-center"
                    :class="[copied ? 'bg-green-500 text-white hover:text-white hover:bg-green-500' : 'text-gray-400 hover:text-gray-500 hover:bg-gray-100 bg-white opacity-70']">
              <i class="fas fa-copy"></i>
              <span v-if="copied" class="ml-2">Copied</span>
            </button>
          </span>
        </div>
        <div class="flex">
          <div class="mb-0">
            <div @click="open" class="h-[120px] w-[120px]" :class="{ 'cursor-pointer': canEdit }">
              <img :src="icon || image || '/logo.png'" class="h-[120px] w-[120px] object-cover rounded-2xl">
            </div>
            <div class="mt-4">
              <custom-select
                  v-if="canEdit"
                  :list="categories"
                  :value="category"
                  @change="changeCategory"
              />
            </div>
          </div>
          <div class="flex-auto ml-5">
            <div @click="open" v-if="title || description" class="flex items-center justify-between mt-2 mb-2" :class="{ 'cursor-pointer': canEdit }">
              <div class="flex items-center">
                <div class="flex flex-col">
                  <div v-if="title" class="w-full flex-none text-lg text-gray-800 font-bold leading-none sm:min-h-[55px]">{{ title }}</div>
                  <div class="flex-auto text-gray-500 my-1 sm:min-h-[110px]">
                    <span class="mr-3">{{ description || '(No description)' }}</span>
                  </div>
                </div>
              </div>
            </div>
            <div v-if="notes">
              Notes: {{ notes }}
            </div>
          </div>
        </div>
        <button v-for="(t, i) in tags"
                :key="i"
                @click="toggleTag(t)"
                class="bg-blue-600 px-2 py-1 mr-2 mb-2 text-sm shadow-sm font-medium tracking-wider text-blue-100 rounded-full hover:shadow-2xl hover:bg-blue-700">
          {{ t }}
        </button>
      </div>
    </div>
  </div>
</template>
